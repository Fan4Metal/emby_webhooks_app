<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Emby Webhooks Monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">

    <!-- PWA: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω" -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Emby Webhooks Monitor">
    <link rel="apple-touch-icon" href="/static/favicon.ico">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            font-size: 16px;
            background: #fafafa;
            color: #222;
        }

        h1 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .controls {
            margin-bottom: 10px;
        }

        button {
            padding: 10px 16px;
            font-size: 16px;
            border: none;
            background: #d9534f;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #c9302c;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            word-wrap: break-word;
        }

        th {
            background: #f4f4f4;
            font-size: 14px;
        }

        td {
            font-size: 14px;
        }

        /* –¶–≤–µ—Ç–∞ —Å–æ–±—ã—Ç–∏–π */
        .event-start { background: #dff0d8; }
        .event-pause { background: #fcf8e3; }
        .event-stop  { background: #f2dede; }

        /* üåô Dark mode */
        @media (prefers-color-scheme: dark) {
            body {
                background: #121212;
                color: #eee;
            }
            table {
                border-color: #444;
            }
            th, td {
                border: 1px solid #444;
            }
            th {
                background: #222;
                color: #fff;
            }
            .event-start { background: #1b3d1b; }
            .event-pause { background: #4a3d1a; }
            .event-stop  { background: #4a1a1a; }
            button {
                background: #c9302c;
            }
            button:hover {
                background: #a02220;
            }
        }
    </style>
</head>
<body>
    <h1>üì∫ Emby Webhooks Monitor</h1>

    <div class="controls">
        <form method="post" action="/clear" onsubmit="return confirm('–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏?');">
            <button type="submit">üóë –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </form>
    </div>

    <div class="table-container">
        <table id="webhook-table">
            <thead>
                <tr>
                    <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–°–æ–±—ã—Ç–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <!-- —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </tbody>
        </table>
    </div>

    <script>
        const icons = {
            "playback.start": "‚ñ∂Ô∏è",
            "playback.stop": "‚èπ",
            "playback.pause": "‚è∏",
            "playback.unpause": "‚ñ∂Ô∏è",
            "system.notification": "üîî"
        };

        async function loadData() {
            const response = await fetch('/data');
            const data = await response.json();
            const tbody = document.querySelector('#webhook-table tbody');
            tbody.innerHTML = '';

            data.forEach(row => {
                const tr = document.createElement('tr');
                let cls = "";
                if (row.event === "playback.start" || row.event === "playback.unpause") cls = "event-start";
                else if (row.event === "playback.pause") cls = "event-pause";
                else if (row.event === "playback.stop") cls = "event-stop";
                tr.className = cls;

                const icon = icons[row.event] || "üì∫";
                tr.innerHTML = `
                    <td>${row.title}</td>
                    <td>${row.date}</td>
                    <td>${icon} ${row.event}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        loadData();
        setInterval(loadData, 10000);
    </script>
</body>
</html>
